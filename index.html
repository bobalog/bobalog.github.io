<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>bobalog ë³¸ë¶€ ğŸ§‹</title>
  <style>
    @font-face { font-family: 'Mabiyet'; src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2207-01@1.0/MabinogiClassicR.woff2') format('woff2'); }
    :root { --pink: #ffafcc; --purple: #cdb4db; --bg: #fdf0f5; }
    body { background: var(--bg); font-family: 'Mabiyet', sans-serif; color: #555; margin: 0; display: flex; justify-content: center; }
    .container { width: 100%; max-width: 480px; padding: 20px; box-sizing: border-box; }
    .card { background: white; padding: 20px; border-radius: 25px; box-shadow: 0 8px 15px rgba(255,175,204,0.1); margin-bottom: 20px; border: 2px solid #fff; }
    .btn { padding: 12px; border-radius: 15px; border: none; color: white; cursor: pointer; font-weight: bold; font-family: 'Mabiyet'; font-size: 15px; }
    .pink-btn { background: var(--pink); width: 100%; }
    .purple-btn { background: var(--purple); color: white; text-decoration: none; display: inline-block; text-align: center; }
    input, textarea { width: 100%; padding: 12px; border: 1px solid #ffc8dd; border-radius: 12px; font-family: 'Mabiyet'; margin-bottom: 10px; box-sizing: border-box; }
    .hidden { display: none !important; }
    .header-links { display: flex; gap: 5px; margin-bottom: 15px; }
    .stock-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
    .date-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-weight: bold; color: var(--pink); }
    ul { list-style: none; padding: 0; }
    li { background: #fff5f8; padding: 10px; margin: 5px 0; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
    .done { text-decoration: line-through; opacity: 0.5; }
  </style>
</head>
<body>

<div class="container">
  
  <div id="login-page" class="card">
    <h1 style="color: var(--pink); text-align: center;">ğŸ§‹ bobalog</h1>
    <p style="text-align: center; font-size: 14px;">íƒœìœ¤ì•„, ë¡œê·¸ì¸ì´ í•„ìš”í•´!</p>
    <input type="email" id="email" placeholder="ì´ë©”ì¼" value="abc.bobatea@gmail.com">
    <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" value="rltgjqm">
    <button class="btn pink-btn" id="login-btn">ëŒ€ì‹œë³´ë“œ ì…ì¥í•˜ê¸° âœ…</button>
  </div>

  <div id="dashboard-page" class="hidden">
    <div class="header-links">
      <a href="https://gemini.google.com" target="_blank" class="btn purple-btn" style="flex:1">Gemini</a>
      <a href="https://chatgpt.com" target="_blank" class="btn purple-btn" style="flex:1">ChatGPT</a>
      <a href="https://grok.com" target="_blank" class="btn purple-btn" style="flex:1">Grok</a>
    </div>

    <div class="card">
      <div class="stock-grid">
        <a href="https://finance.naver.com/item/main.naver?code=005930" target="_blank" class="btn pink-btn" style="text-decoration:none; text-align:center;">ì‚¼ì„±ì „ì ğŸ“ˆ</a>
        <a href="https://finance.naver.com/sise/sise_index.naver?code=KOSPI" target="_blank" class="btn pink-btn" style="text-decoration:none; text-align:center;">KOSPI ğŸ“Š</a>
      </div>
      <div style="text-align: center;">
        <h2 id="clock" style="margin: 5px 0; color: var(--pink);">00:00:00</h2>
        <p id="weather">â˜€ï¸ ì˜¤ëŠ˜ ë‚ ì”¨ ìµœê³ !</p>
      </div>
    </div>

    <div class="card">
      <div class="date-nav">
        <button onclick="changeDate(-1)" style="background:none; border:none; cursor:pointer; color:var(--pink); font-weight:bold;">â—€</button>
        <span id="date-text">2025-12-19</span>
        <button onclick="changeDate(1)" style="background:none; border:none; cursor:pointer; color:var(--pink); font-weight:bold;">â–¶</button>
      </div>
      <div style="display: flex; gap: 5px;">
        <input type="text" id="todo-input" placeholder="í•  ì¼ ì…ë ¥..." style="margin:0;">
        <button id="add-todo-btn" class="btn purple-btn">ì¶”ê°€</button>
      </div>
      <ul id="todo-list"></ul>
    </div>

    <div class="card">
      <h2>ğŸ“ ì˜¤ëŠ˜ì˜ ê¸°ë¡</h2>
      <textarea id="diary-box" rows="4" placeholder="ì˜¤ëŠ˜ ì–´ë• ì–´?"></textarea>
      <button onclick="saveDiary()" class="btn pink-btn">ì¼ê¸° ì €ì¥ ğŸ€</button>
    </div>

    <button onclick="logout()" style="width:100%; background:none; border:none; color:#ccc; cursor:pointer; margin-top:10px;">ë¡œê·¸ì•„ì›ƒ</button>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  const S_URL = "https://hyydywzsvnfhdrexntnl.supabase.co";
  const S_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh5eWR5d3pzdm5maGRyZXhudG5sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxMjE3MTAsImV4cCI6MjA4MTY5NzcxMH0.2vrbtBozzHeUle9a1foYmsz4o3jkPN5GtbBM0F-eK20";
  let supabase, viewDate = new Date();

  // ì´ˆê¸°í™”
  window.addEventListener('DOMContentLoaded', async () => {
    supabase = window.supabase.createClient(S_URL, S_KEY);
    
    // ì„¸ì…˜ í™•ì¸
    const { data: { session } } = await supabase.auth.getSession();
    if (session) showMain();
    else showLogin();

    // ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (ì´ê²Œ ì ¤ í™•ì‹¤í•¨)
    document.getElementById('login-btn').addEventListener('click', login);
    document.getElementById('add-todo-btn').addEventListener('click', addTodo);
    
    // ì‹œê³„ ì‹œì‘
    setInterval(() => {
      document.getElementById('clock').innerText = new Date().toLocaleTimeString('ko-KR');
    }, 1000);
  });

  function showLogin() {
    document.getElementById('login-page').classList.remove('hidden');
    document.getElementById('dashboard-page').classList.add('hidden');
  }

  function showMain() {
    document.getElementById('login-page').classList.add('hidden');
    document.getElementById('dashboard-page').classList.remove('hidden');
    renderDate();
  }

  // ë¡œê·¸ì¸ í•¨ìˆ˜
  async function login() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const { error } = await supabase.auth.signInWithPassword({ email, password });
    if (error) alert("ë¡œê·¸ì¸ ì‹¤íŒ¨ã… : " + error.message);
    else location.reload();
  }

  async function logout() {
    await supabase.auth.signOut();
    location.reload();
  }

  // ë‚ ì§œ ì œì–´
  function renderDate() {
    const dateStr = viewDate.toISOString().split('T')[0];
    document.getElementById('date-text').innerText = dateStr;
    loadTodos(dateStr);
    document.getElementById('diary-box').value = localStorage.getItem('diary_' + dateStr) || '';
  }

  function changeDate(n) {
    viewDate.setDate(viewDate.getDate() + n);
    renderDate();
  }

  // íˆ¬ë‘ (DB ì—°ë™)
  async function loadTodos(date) {
    const { data } = await supabase.from('tasks').select('*').eq('due', date).order('created_at', { ascending: true });
    const list = document.getElementById('todo-list');
    list.innerHTML = (data || []).map(t => `
      <li class="${t.done ? 'done' : ''}">
        <span>${t.text}</span>
        <button onclick="toggleTodo('${t.id}', ${t.done})" style="border:none; background:none; cursor:pointer;">${t.done ? 'âœ…' : 'â¬œ'}</button>
      </li>
    `).join('');
  }

  async function addTodo() {
    const input = document.getElementById('todo-input');
    if (!input.value) return;
    const dateStr = viewDate.toISOString().split('T')[0];
    const { data: { user } } = await supabase.auth.getUser();
    await supabase.from('tasks').insert([{ user_id: user.id, text: input.value, due: dateStr, done: false }]);
    input.value = '';
    loadTodos(dateStr);
  }

  async function toggleTodo(id, current) {
    await supabase.from('tasks').update({ done: !current }).eq('id', id);
    renderDate();
  }

  // ì¼ê¸° ì €ì¥ (ë¡œì»¬)
  function saveDiary() {
    const dateStr = viewDate.toISOString().split('T')[0];
    localStorage.setItem('diary_' + dateStr, document.getElementById('diary-box').value);
    alert('ì €ì¥ ì™„ë£Œ! âœ¨');
  }
</script>

</body>
</html>
