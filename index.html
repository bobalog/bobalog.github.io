<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>bobalog ì´ˆê°•ë ¥ ë²„ì „ ğŸ§‹</title>

  <style>
    @font-face {
      font-family: 'Mabiyet';
      src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2207-01@1.0/MabinogiClassicR.woff2') format('woff2');
      font-weight: normal;
      font-display: swap;
    }

    body {
      background: #fdf0f5;
      font-family: 'Mabiyet', sans-serif;
      padding: 20px;
      display: flex;
      justify-content: center;
    }

    .container { width: 100%; max-width: 480px; }
    .card {
      background: white;
      padding: 20px;
      border-radius: 25px;
      box-shadow: 0 8px 15px rgba(0,0,0,0.05);
      margin-bottom: 20px;
    }
    .btn {
      padding: 12px;
      border-radius: 15px;
      border: none;
      background: #ffafcc;
      color: white;
      font-weight: bold;
      cursor: pointer;
      width: 100%;
      margin-top: 10px;
    }
    input {
      width: 100%;
      padding: 12px;
      border: 1px solid #ffc8dd;
      border-radius: 12px;
      box-sizing: border-box;
      margin-bottom: 10px;
    }
    ul { padding-left: 18px; }
    li { margin: 6px 0; }
    .small { font-size: 12px; }
    .row { display:flex; gap: 6px; margin-bottom: 15px; }
    .linkbtn {
      flex:1;
      background:#cdb4db;
      color:white;
      padding:10px;
      border-radius:10px;
      text-decoration:none;
      text-align:center;
      display:block;
    }
  </style>
</head>

<body>
  <div class="container">

    <div class="card" style="text-align:center;">
      <h1 style="color:#ff8fab;">ğŸ§‹ bobalog ë³¸ë¶€</h1>
      <p id="status-text" class="small" style="color:red;">âš ï¸ ë¡œê·¸ì¸ ì „ (ë¡œì»¬ ëª¨ë“œ)</p>
      <p id="debug" class="small" style="color:#888; margin-top:6px;"></p>
    </div>

    <div class="card" id="auth-box">
      <input type="email" id="u-email" value="abc.bobatea@gmail.com" />
      <input type="password" id="u-pw" value="rltgjqm" />
      <button class="btn" id="loginBtn" type="button">ì¸ì¦í•˜ê³  DB ì—°ê²°í•˜ê¸° âœ…</button>
    </div>

    <div class="card">
      <div class="row">
        <a class="linkbtn" href="https://gemini.google.com" target="_blank" rel="noopener noreferrer">Gemini</a>
        <a class="linkbtn" href="https://chatgpt.com" target="_blank" rel="noopener noreferrer">GPT</a>
      </div>

      <input type="text" id="t-input" placeholder="í•  ì¼ ì…ë ¥..." />
      <button class="btn" id="addBtn" type="button" style="background:#cdb4db;">í•  ì¼ ì¶”ê°€</button>
      <ul id="t-list"></ul>
    </div>

  </div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    // âœ… ë„ˆì˜ í”„ë¡œì íŠ¸ URL
    const SUPABASE_URL = "https://hyydywzsvnfhdrexntnl.supabase.co";

    // âš ï¸ ì—¬ê¸°ì— Supabase anon keyë¥¼ "ëŒ€ì‹œë³´ë“œì—ì„œ ë‹¤ì‹œ ë³µì‚¬í•œ ê°’"ìœ¼ë¡œ ë¶™ì—¬ë„£ê¸°!
    // (ë³µë¶™ ì¤‘ ì´ìƒí•œ ë¬¸ì ì„ì´ë©´ ì—ëŸ¬ë‚  ìˆ˜ ìˆì–´)
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh5eWR5d3pzdm5maGRyZXhudG5sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxMjE3MTAsImV4cCI6MjA4MTY5NzcxMH0.2vrbtBozzHeUle9a1foYmsz4o3jkPN5GtbBM0F-eK20";

    let sb = null;

    document.addEventListener("DOMContentLoaded", () => {
      // 1) ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ í™•ì¸
      if (!window.supabase) {
        setDebug("Supabase CDN ë¡œë“œ ì‹¤íŒ¨ (ë„¤íŠ¸ì›Œí¬ íƒ­ í™•ì¸)");
        alert("Supabase ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ ì‹¤íŒ¨!");
        return;
      }

      // 2) Supabase client ìƒì„± (ğŸ”¥ í—¤ë” ASCII ê°•ì œ = ì§€ê¸ˆ ì—ëŸ¬ í•´ê²° í•µì‹¬!)
      sb = window.supabase.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY,
        {
          global: {
            headers: {
              "X-Client-Info": "bobalog-web" // âœ… í•œê¸€/ì´ëª¨ì§€ ì ˆëŒ€ ê¸ˆì§€
            }
          }
        }
      );

      setDebug("DOM ë¡œë“œ OK / Supabase client ì¤€ë¹„ë¨ âœ…");

      // 3) ë²„íŠ¼ ì´ë²¤íŠ¸ ì—°ê²° (GitHub Pagesì—ì„œ ì•ˆì •ì )
      document.getElementById("loginBtn").addEventListener("click", emergencyLogin);
      document.getElementById("addBtn").addEventListener("click", localAdd);
    });

    function setDebug(msg) {
      const el = document.getElementById("debug");
      if (el) el.textContent = msg;
      console.log(msg);
    }

    async function emergencyLogin() {
      // âœ… ì—¬ê¸° ì•Œë¦¼ì´ ëœ¨ë©´ "ë²„íŠ¼ í´ë¦­ ìì²´"ëŠ” ì •ìƒ!
      alert("ë²„íŠ¼ í´ë¦­ âœ… ë¡œê·¸ì¸ ì‹œë„!");

      const email = document.getElementById("u-email").value.trim();
      const password = document.getElementById("u-pw").value;

      if (!sb) {
        alert("Supabase ì´ˆê¸°í™”ê°€ ì•ˆ ëì–´!");
        return;
      }

      // í‚¤ê°€ ì•„ì§ placeholderë©´ ì•ˆë‚´
      if (SUPABASE_ANON_KEY.includes("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh5eWR5d3pzdm5maGRyZXhudG5sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxMjE3MTAsImV4cCI6MjA4MTY5NzcxMH0.2vrbtBozzHeUle9a1foYmsz4o3jkPN5GtbBM0F-eK20")) {
        alert("SUPABASE_ANON_KEYë¥¼ ì‹¤ì œ anon keyë¡œ ë°”ê¿”ì¤˜!");
        return;
      }

      try {
        const { data, error } = await sb.auth.signInWithPassword({ email, password });

        if (error) {
          alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + error.message);
          setDebug("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + error.message);
          console.log(error);
          return;
        }

        // ì„±ê³µ UI
        document.getElementById("status-text").innerText = "âœ… DB ì—°ê²° ì™„ë£Œ";
        document.getElementById("status-text").style.color = "green";
        setDebug("ë¡œê·¸ì¸ ì„±ê³µ âœ…");
        alert("ì„±ê³µ! ì´ì œ DB ì—°ê²°ë¨ ğŸ‰");

        console.log("login data:", data);
      } catch (e) {
        alert("ì˜ˆì™¸ ë°œìƒ: " + e.message);
        setDebug("ì˜ˆì™¸: " + e.message);
        console.log(e);
      }
    }

    function localAdd() {
      const val = document.getElementById("t-input").value.trim();
      if (!val) return;

      const li = document.createElement("li");
      li.textContent = val;
      document.getElementById("t-list").appendChild(li);

      document.getElementById("t-input").value = "";
    }
  </script>
</body>
</html>
